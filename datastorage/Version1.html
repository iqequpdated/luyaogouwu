<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>璐瑶购物 - 完整电商系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root{--primary:#1890ff;--accent:#ff4757;--muted:#777;--bg:#f7f8fa}
        *{box-sizing:border-box}
        body{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);margin:0;color:#222}
        .container{max-width:1100px;margin:20px auto;padding:0 16px}
        .navbar{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
        .logo{font-weight:700;display:flex;align-items:center;gap:8px}
        .nav-links a{margin-left:12px;color:#333;text-decoration:none}
        .slider{width:100%;height:260px;border-radius:8px;overflow:hidden;background:linear-gradient(90deg,#6a11cb,#2575fc);display:flex;align-items:center;justify-content:center;color:#fff;margin-bottom:18px}
        .section-title{font-size:18px;margin:12px 0;font-weight:700}
        .products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
        .product-card{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.06);display:flex;flex-direction:column}
        .product-image{height:160px;background:#f0f0f0;display:flex;align-items:center;justify-content:center}
        .product-image img{max-width:100%;max-height:100%}
        .product-info{padding:12px;flex:1;display:flex;flex-direction:column;gap:8px}
        .product-name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .product-price{color:var(--accent);font-weight:700}
        .product-actions{margin-top:auto;display:flex;gap:8px}
        .btn{padding:8px 10px;border-radius:6px;border:none;cursor:pointer}
        .btn-primary{background:var(--primary);color:#fff}
        .btn-outline{background:#fff;border:1px solid #e6e6e6}
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:999}
        .modal.active{display:flex}
        .modal-content{background:#fff;border-radius:8px;padding:16px;max-width:720px;width:100%;max-height:90vh;overflow:auto}
        .grid-2{display:grid;grid-template-columns:1fr 300px;gap:16px}
        .cart-item{display:flex;gap:12px;padding:8px 0;border-bottom:1px solid #f0f0f0}
        footer{margin-top:30px;padding:20px 0;text-align:center;color:var(--muted)}
        @media(max-width:800px){.grid-2{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <header class="navbar">
            <div class="logo"><i class="fas fa-shopping-bag"></i><span>璐瑶购物</span></div>
            <nav class="nav-links">
                <a href="#" id="link-home">首页</a>
                <a href="#" id="link-shop">商店</a>
                <a href="./settings.html" id="link-settings">设置</a>
                <a href="./users.html" id="link-users">用户管理</a>
            </nav>
        </header>

        <div class="slider">欢迎来到 璐瑶购物 — 简洁电商前端示例</div>

        <div class="section-title">热销商品</div>
        <div class="products-grid" id="productsGrid"></div>

        <div class="section-title">全部商品</div>
        <div class="products-grid" id="allProductsGrid"></div>

        <footer>版本: <span id="siteVersion">-</span> · © 璐瑶购物</footer>
    </div>

    <!-- 产品详情模态 -->
    <div class="modal" id="productModal" aria-hidden="true">
        <div class="modal-content">
            <button class="close-modal btn-outline" id="closeProductModal" style="float:right">✕</button>
            <div id="productDetail"></div>
        </div>
    </div>

    <!-- 购物车模态 -->
    <div class="modal" id="cartModal" aria-hidden="true">
        <div class="modal-content">
            <button class="close-modal btn-outline" id="closeCartModal" style="float:right">✕</button>
            <h3>购物车</h3>
            <div id="cartList"></div>
            <div style="margin-top:12px;text-align:right">
                <strong>合计: ¥<span id="cartTotal">0.00</span></strong>
                <button class="btn btn-primary" id="checkoutBtn" style="margin-left:12px">去结算</button>
            </div>
        </div>
    </div>

    <script>
    (function(){
        // 简单数据管理（可替换为后端API）
        class DataManager {
            constructor() {
                this.products = [
                    {id:1,name:"iPhone 14 Pro",price:8999,category:"digital",image:"https://via.placeholder.com/300x200?text=iPhone+14+Pro",desc:"A16芯片，强劲性能"},
                    {id:2,name:"夏季连衣裙",price:299,category:"clothing",image:"https://via.placeholder.com/300x200?text=Dress",desc:"轻盈透气"},
                    {id:3,name:"小米电视",price:2499,category:"digital",image:"https://via.placeholder.com/300x200?text=TV",desc:"4K智能电视"},
                    {id:4,name:"运动鞋",price:399,category:"clothing",image:"https://via.placeholder.com/300x200?text=Shoes",desc:"轻便舒适"},
                    {id:5,name:"汽车香水",price:89,category:"car",image:"https://via.placeholder.com/300x200?text=Perfume",desc:"清新持久"}
                ];
                this.cart = JSON.parse(localStorage.getItem('cart')||'[]');
            }
            listProducts(){ return this.products; }
            getProduct(id){ return this.products.find(p=>p.id===id); }
            addToCart(item){ 
                const exist = this.cart.find(i=>i.id===item.id);
                if(exist){ exist.quantity += item.quantity; }
                else this.cart.push({...item});
                this.persistCart();
            }
            persistCart(){ localStorage.setItem('cart', JSON.stringify(this.cart)); }
            clearCart(){ this.cart = []; this.persistCart(); }
        }

        const dm = new DataManager();

        // 渲染
        function createCard(p){
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="product-image"><img src="${p.image}" alt="${p.name}"></div>
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div class="product-price">¥${p.price}</div>
                    <div class="product-actions">
                        <button class="btn btn-outline" data-action="view" data-id="${p.id}">查看</button>
                        <button class="btn btn-primary" data-action="add" data-id="${p.id}">加入购物车</button>
                    </div>
                </div>
            `;
            card.querySelector('[data-action="view"]').addEventListener('click', ()=>openProduct(p.id));
            card.querySelector('[data-action="add"]').addEventListener('click', ()=>{ dm.addToCart({id:p.id, name:p.name, price:p.price, quantity:1}); renderCart(); showToast('已加入购物车'); });
            return card;
        }

        function renderProducts(){
            const grid = document.getElementById('productsGrid');
            const all = document.getElementById('allProductsGrid');
            grid.innerHTML=''; all.innerHTML='';
            const list = dm.listProducts();
            list.slice(0,4).forEach(p=>grid.appendChild(createCard(p)));
            list.forEach(p=>all.appendChild(createCard(p)));
        }

        // 产品详情
        function openProduct(id){
            const p = dm.getProduct(id);
            const box = document.getElementById('productModal');
            const detail = document.getElementById('productDetail');
            detail.innerHTML = `
                <h2>${p.name}</h2>
                <img src="${p.image}" style="max-width:100%;border-radius:6px;margin:8px 0">
                <p>${p.desc}</p>
                <p class="product-price">¥${p.price}</p>
                <div style="text-align:right">
                    <button class="btn btn-outline" id="pAddClose">关闭</button>
                    <button class="btn btn-primary" id="pAddCart">加入购物车</button>
                </div>
            `;
            document.getElementById('pAddCart').addEventListener('click', ()=>{ dm.addToCart({id:p.id,name:p.name,price:p.price,quantity:1}); renderCart(); showToast('已加入购物车'); closeModal('productModal'); });
            document.getElementById('pAddClose').addEventListener('click', ()=>closeModal('productModal'));
            box.classList.add('active');
        }

        // 购物车
        function renderCart(){
            const list = document.getElementById('cartList');
            list.innerHTML = '';
            const cart = dm.cart;
            let total = 0;
            if(cart.length===0){ list.innerHTML = '<div style="padding:20px;color:#777">购物车空</div>'; }
            cart.forEach(item=>{
                total += item.price * item.quantity;
                const el = document.createElement('div');
                el.className = 'cart-item';
                el.innerHTML = `
                    <div style="width:60px;height:60px;background:#fafafa;border-radius:6px;display:flex;align-items:center;justify-content:center">${item.name}</div>
                    <div style="flex:1">
                        <div>${item.name}</div>
                        <div style="color:#999">¥${item.price} × ${item.quantity}</div>
                    </div>
                    <div>
                        <button class="btn btn-outline" data-id="${item.id}" data-act="dec">-</button>
                        <button class="btn btn-outline" data-id="${item.id}" data-act="inc">+</button>
                    </div>
                `;
                el.querySelector('[data-act="dec"]').addEventListener('click', ()=>{ changeQty(item.id, -1); });
                el.querySelector('[data-act="inc"]').addEventListener('click', ()=>{ changeQty(item.id, 1); });
                list.appendChild(el);
            });
            document.getElementById('cartTotal').textContent = total.toFixed(2);
        }

        function changeQty(id, delta){
            const it = dm.cart.find(i=>i.id===id);
            if(!it) return;
            it.quantity += delta;
            if(it.quantity <= 0) dm.cart = dm.cart.filter(i=>i.id!==id);
            dm.persistCart();
            renderCart();
        }

        // UI helpers
        function closeModal(id){ document.getElementById(id).classList.remove('active'); }
        function showToast(msg){
            const t = document.createElement('div');
            t.textContent = msg;
            Object.assign(t.style,{position:'fixed',left:'50%',top:'80px',transform:'translateX(-50%)',background:'#333',color:'#fff',padding:'10px 14px',borderRadius:'6px',zIndex:1200});
            document.body.appendChild(t);
            setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=>t.remove(),300); },2000);
        }

        // 事件绑定
        document.getElementById('closeProductModal').addEventListener('click', ()=>closeModal('productModal'));
        document.getElementById('closeCartModal').addEventListener('click', ()=>closeModal('cartModal'));
        document.getElementById('checkoutBtn').addEventListener('click', ()=>{ if(dm.cart.length===0){ showToast('购物车为空'); return } showToast('模拟结算成功'); dm.clearCart(); renderCart(); closeModal('cartModal'); });

        // 版本显示（读取 Version 文件）
        async function loadVersion(){
            try{
                const r = await fetch('./Version', {cache:'no-store'});
                if(r.ok){ const v = (await r.text()).trim(); document.getElementById('siteVersion').textContent = v || '未知'; return; }
            }catch(e){}
            document.getElementById('siteVersion').textContent = '1.0.0';
        }

        // 快捷键或链接打开购物车
        document.addEventListener('keydown', (e)=>{ if(e.key==='c' && (e.ctrlKey||e.metaKey)){ document.getElementById('cartModal').classList.add('active'); renderCart(); }});
        // 小型 nav hooks
        document.getElementById('link-shop').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top: document.getElementById('allProductsGrid').offsetTop-80, behavior:'smooth'}); });

        // init
        renderProducts();
        renderCart();
        loadVersion();
    })();
    </script>
</body>
</html>