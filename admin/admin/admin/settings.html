<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统设置 - 璐瑶购物后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 基础样式 - 与产品管理页面保持一致 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .admin-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 页面头部 */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* 按钮样式 */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #bdc3c7;
            color: #7f8c8d;
        }

        .btn-outline:hover {
            background-color: #ecf0f1;
        }

        .btn-success {
            background-color: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        /* 卡片样式 */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .card-body {
            padding: 20px;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* 设置特定样式 */
        .settings-tabs {
            display: flex;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 20px;
        }

        .settings-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #7f8c8d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .settings-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .settings-tab:hover {
            color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .logo-preview {
            width: 120px;
            height: 120px;
            border: 1px dashed #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
        }

        .image-upload-container {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .image-upload-container:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .backup-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background-color: #e8f4fd;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .backup-status.success {
            background-color: #e8f6ef;
        }

        .backup-status.warning {
            background-color: #fef9e7;
        }

        .backup-status.danger {
            background-color: #fdedec;
        }

        .status-icon {
            font-size: 20px;
        }

        .status-icon.success {
            color: #27ae60;
        }

        .status-icon.warning {
            color: #f39c12;
        }

        .status-icon.danger {
            color: #e74c3c;
        }

        .backup-info {
            flex: 1;
        }

        .backup-info h4 {
            margin-bottom: 5px;
            font-size: 14px;
            color: #2c3e50;
        }

        .backup-info p {
            font-size: 12px;
            color: #7f8c8d;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .danger-zone {
            border: 1px solid #e74c3c;
            border-radius: 8px;
            padding: 20px;
            background-color: #fdedec;
        }

        .danger-zone h3 {
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .danger-zone p {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .text-center {
            text-align: center;
        }

        .text-danger {
            color: #e74c3c;
        }

        .text-success {
            color: #27ae60;
        }

        .text-muted {
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div>
                <div class="page-title">系统设置</div>
                <div class="breadcrumb">
                    <a href="../dashboard.html">首页</a>
                    <i class="fas fa-chevron-right"></i>
                    <a href="settings.html">系统设置</a>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn btn-outline" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                    刷新
                </button>
                <button class="btn btn-primary" id="save-settings-btn">
                    <i class="fas fa-save"></i>
                    保存设置
                </button>
            </div>
        </div>

        <!-- 设置选项卡 -->
        <div class="card">
            <div class="settings-tabs">
                <button class="settings-tab active" data-tab="general">基本设置</button>
                <button class="settings-tab" data-tab="system">系统配置</button>
                <button class="settings-tab" data-tab="security">安全设置</button>
                <button class="settings-tab" data-tab="email">邮件配置</button>
                <button class="settings-tab" data-tab="backup">备份与恢复</button>
            </div>

            <!-- 基本设置 -->
            <div class="tab-content active" id="general-tab">
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="site-name">站点名称</label>
                            <input type="text" id="site-name" class="form-control" placeholder="请输入站点名称">
                        </div>
                        <div class="form-group">
                            <label for="site-url">站点网址</label>
                            <input type="text" id="site-url" class="form-control" placeholder="https://example.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="site-description">站点描述</label>
                        <textarea id="site-description" class="form-control" rows="3" placeholder="请输入站点描述"></textarea>
                    </div>

                    <div class="form-group">
                        <label>站点Logo</label>
                        <div class="logo-preview" id="logo-preview">
                            <span class="text-muted">暂无Logo</span>
                        </div>
                        <div class="image-upload-container" id="logo-upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div>
                                <div>点击上传Logo或拖拽图片到这里</div>
                                <div class="text-muted" style="font-size: 12px; margin-top: 5px;">
                                    建议尺寸：200x60像素，支持 JPG、PNG 格式
                                </div>
                            </div>
                            <input type="file" id="site-logo" accept="image/*" style="display: none;">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="contact-email">联系邮箱</label>
                            <input type="email" id="contact-email" class="form-control" placeholder="admin@example.com">
                        </div>
                        <div class="form-group">
                            <label for="contact-phone">联系电话</label>
                            <input type="text" id="contact-phone" class="form-control" placeholder="+86 123 4567 8900">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="site-keywords">站点关键词</label>
                        <input type="text" id="site-keywords" class="form-control" placeholder="关键词1, 关键词2, 关键词3">
                        <div class="form-text">多个关键词请用英文逗号分隔</div>
                    </div>
                </div>
            </div>

            <!-- 系统配置 -->
            <div class="tab-content" id="system-tab">
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone">时区设置</label>
                            <select id="timezone" class="form-control">
                                <option value="Asia/Shanghai">(UTC+08:00) 北京时间</option>
                                <option value="Asia/Tokyo">(UTC+09:00) 东京时间</option>
                                <option value="America/New_York">(UTC-05:00) 纽约时间</option>
                                <option value="Europe/London">(UTC+00:00) 伦敦时间</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="language">默认语言</label>
                            <select id="language" class="form-control">
                                <option value="zh-CN">简体中文</option>
                                <option value="en-US">English</option>
                                <option value="ja-JP">日本語</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="currency">默认货币</label>
                            <select id="currency" class="form-control">
                                <option value="CNY">人民币 (CNY)</option>
                                <option value="USD">美元 (USD)</option>
                                <option value="EUR">欧元 (EUR)</option>
                                <option value="JPY">日元 (JPY)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date-format">日期格式</label>
                            <select id="date-format" class="form-control">
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="items-per-page">每页显示数量</label>
                        <select id="items-per-page" class="form-control">
                            <option value="10">10条</option>
                            <option value="20">20条</option>
                            <option value="50">50条</option>
                            <option value="100">100条</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="maintenance-mode">
                            启用维护模式
                        </label>
                        <div class="form-text">启用后网站将显示维护页面，仅管理员可以访问</div>
                    </div>
                </div>
            </div>

            <!-- 安全设置 -->
            <div class="tab-content" id="security-tab">
                <div class="card-body">
                    <div class="form-group">
                        <label for="session-timeout">会话超时时间（分钟）</label>
                        <input type="number" id="session-timeout" class="form-control" min="5" max="480" value="30">
                        <div class="form-text">用户无操作后自动登出的时间</div>
                    </div>

                    <div class="form-group">
                        <label for="password-min-length">密码最小长度</label>
                        <input type="number" id="password-min-length" class="form-control" min="6" max="20" value="8">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="password-require-uppercase">
                            密码必须包含大写字母
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="password-require-lowercase">
                            密码必须包含小写字母
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="password-require-numbers">
                            密码必须包含数字
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="password-require-symbols">
                            密码必须包含特殊字符
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="login-attempt-limit">
                            启用登录尝试限制
                        </label>
                        <div class="form-text">启用后，连续登录失败将暂时锁定账户</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="max-login-attempts">最大登录尝试次数</label>
                            <input type="number" id="max-login-attempts" class="form-control" min="3" max="10" value="5" disabled>
                        </div>
                        <div class="form-group">
                            <label for="lockout-duration">锁定时间（分钟）</label>
                            <input type="number" id="lockout-duration" class="form-control" min="5" max="120" value="15" disabled>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 邮件配置 -->
            <div class="tab-content" id="email-tab">
                <div class="card-body">
                    <div class="form-group">
                        <label for="mailer-type">邮件发送方式</label>
                        <select id="mailer-type" class="form-control">
                            <option value="smtp">SMTP</option>
                            <option value="sendmail">Sendmail</option>
                            <option value="mail">PHP Mail()</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="smtp-host">SMTP服务器</label>
                            <input type="text" id="smtp-host" class="form-control" placeholder="smtp.example.com">
                        </div>
                        <div class="form-group">
                            <label for="smtp-port">SMTP端口</label>
                            <input type="number" id="smtp-port" class="form-control" value="587">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="smtp-username">SMTP用户名</label>
                            <input type="text" id="smtp-username" class="form-control" placeholder="username@example.com">
                        </div>
                        <div class="form-group">
                            <label for="smtp-password">SMTP密码</label>
                            <input type="password" id="smtp-password" class="form-control" placeholder="请输入密码">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="from-email">发件人邮箱</label>
                        <input type="email" id="from-email" class="form-control" placeholder="noreply@example.com">
                    </div>

                    <div class="form-group">
                        <label for="from-name">发件人名称</label>
                        <input type="text" id="from-name" class="form-control" placeholder="系统管理员">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="smtp-auth">
                            SMTP需要身份验证
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="smtp-secure">
                            启用SSL/TLS加密
                        </label>
                    </div>

                    <div class="form-group">
                        <button class="btn btn-outline" id="test-email-btn">
                            <i class="fas fa-paper-plane"></i>
                            测试邮件发送
                        </button>
                        <div class="form-text">点击测试邮件发送功能是否正常</div>
                    </div>
                </div>
            </div>

            <!-- 备份与恢复 -->
            <div class="tab-content" id="backup-tab">
                <div class="card-body">
                    <div class="backup-status">
                        <div class="status-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="backup-info">
                            <h4>系统运行正常</h4>
                            <p>上次备份：2023-11-15 14:30:25 | 数据库大小：45.2 MB</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="backup-frequency">自动备份频率</label>
                        <select id="backup-frequency" class="form-control">
                            <option value="daily">每天</option>
                            <option value="weekly" selected>每周</option>
                            <option value="monthly">每月</option>
                            <option value="never">不自动备份</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="backup-retention">备份保留时间</label>
                        <select id="backup-retention" class="form-control">
                            <option value="7">7天</option>
                            <option value="30" selected>30天</option>
                            <option value="90">90天</option>
                            <option value="365">1年</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="backup-database">
                            备份数据库
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="backup-files">
                            备份文件
                        </label>
                    </div>

                    <div class="form-group">
                        <button class="btn btn-success" id="backup-now-btn">
                            <i class="fas fa-download"></i>
                            立即备份
                        </button>
                        <button class="btn btn-outline" id="restore-backup-btn">
                            <i class="fas fa-upload"></i>
                            恢复备份
                        </button>
                    </div>

                    <div class="danger-zone">
                        <h3><i class="fas fa-exclamation-triangle"></i> 危险操作</h3>
                        <p>这些操作可能会导致数据丢失，请谨慎操作</p>
                        <button class="btn btn-danger" id="reset-settings-btn">
                            <i class="fas fa-trash"></i>
                            恢复默认设置
                        </button>
                        <button class="btn btn-danger" id="clear-cache-btn">
                            <i class="fas fa-broom"></i>
                            清除缓存
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 测试邮件模态框 -->
    <div class="modal" id="test-email-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">测试邮件发送</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="test-email-address">测试邮箱地址</label>
                    <input type="email" id="test-email-address" class="form-control" placeholder="test@example.com">
                </div>
                <div id="test-email-result" class="text-center" style="display: none; margin-top: 15px;">
                    <!-- 测试结果将显示在这里 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-test-email">取消</button>
                <button class="btn btn-primary" id="send-test-email">发送测试邮件</button>
            </div>
        </div>
    </div>

    <!-- 确认重置设置模态框 -->
    <div class="modal" id="reset-settings-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">确认重置设置</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要将所有设置恢复为默认值吗？</p>
                <p class="text-danger"><strong>此操作不可撤销，所有自定义设置将会丢失！</strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-reset">取消</button>
                <button class="btn btn-danger" id="confirm-reset">确认重置</button>
            </div>
        </div>
    </div>

    <script>
        // 系统设置管理类
        class SettingsManagement {
            constructor() {
                this.currentSettings = {};
                this.init();
            }

            init() {
                this.loadSettings();
                this.setupEventListeners();
                this.setupTabNavigation();
            }

            // 加载设置
            loadSettings() {
                // 从localStorage加载设置，如果没有则使用默认值
                const storedSettings = localStorage.getItem('luyao_settings');
                if (storedSettings) {
                    try {
                        this.currentSettings = JSON.parse(storedSettings);
                        this.populateForm(this.currentSettings);
                    } catch (error) {
                        console.error('Error parsing settings:', error);
                        this.loadDefaultSettings();
                    }
                } else {
                    this.loadDefaultSettings();
                }
            }

            // 加载默认设置
            loadDefaultSettings() {
                this.currentSettings = {
                    general: {
                        siteName: '璐瑶购物',
                        siteUrl: 'https://luyaoshop.com',
                        siteDescription: '高品质购物平台',
                        contactEmail: 'admin@luyaoshop.com',
                        contactPhone: '+86 123 4567 8900',
                        siteKeywords: '购物,电商,在线商城'
                    },
                    system: {
                        timezone: 'Asia/Shanghai',
                        language: 'zh-CN',
                        currency: 'CNY',
                        dateFormat: 'YYYY-MM-DD',
                        itemsPerPage: '20',
                        maintenanceMode: false
                    },
                    security: {
                        sessionTimeout: 30,
                        passwordMinLength: 8,
                        passwordRequireUppercase: true,
                        passwordRequireLowercase: true,
                        passwordRequireNumbers: true,
                        passwordRequireSymbols: false,
                        loginAttemptLimit: true,
                        maxLoginAttempts: 5,
                        lockoutDuration: 15
                    },
                    email: {
                        mailerType: 'smtp',
                        smtpHost: 'smtp.luyaoshop.com',
                        smtpPort: 587,
                        smtpUsername: 'noreply@luyaoshop.com',
                        fromEmail: 'noreply@luyaoshop.com',
                        fromName: '璐瑶购物',
                        smtpAuth: true,
                        smtpSecure: true
                    },
                    backup: {
                        backupFrequency: 'weekly',
                        backupRetention: 30,
                        backupDatabase: true,
                        backupFiles: true
                    }
                };
                this.saveSettings();
                this.populateForm(this.currentSettings);
            }

            // 填充表单 - 修复了undefined错误
            populateForm(settings) {
                // 添加安全检查
                if (!settings) {
                    console.error('Settings object is undefined, loading defaults');
                    this.loadDefaultSettings();
                    return;
                }

                // 基本设置 - 使用可选链操作符和空值合并
                document.getElementById('site-name').value = settings.general?.siteName || '';
                document.getElementById('site-url').value = settings.general?.siteUrl || '';
                document.getElementById('site-description').value = settings.general?.siteDescription || '';
                document.getElementById('contact-email').value = settings.general?.contactEmail || '';
                document.getElementById('contact-phone').value = settings.general?.contactPhone || '';
                document.getElementById('site-keywords').value = settings.general?.siteKeywords || '';

                // 系统配置
                document.getElementById('timezone').value = settings.system?.timezone || 'Asia/Shanghai';
                document.getElementById('language').value = settings.system?.language || 'zh-CN';
                document.getElementById('currency').value = settings.system?.currency || 'CNY';
                document.getElementById('date-format').value = settings.system?.dateFormat || 'YYYY-MM-DD';
                document.getElementById('items-per-page').value = settings.system?.itemsPerPage || '20';
                document.getElementById('maintenance-mode').checked = settings.system?.maintenanceMode || false;

                // 安全设置
                document.getElementById('session-timeout').value = settings.security?.sessionTimeout || 30;
                document.getElementById('password-min-length').value = settings.security?.passwordMinLength || 8;
                document.getElementById('password-require-uppercase').checked = settings.security?.passwordRequireUppercase || false;
                document.getElementById('password-require-lowercase').checked = settings.security?.passwordRequireLowercase || false;
                document.getElementById('password-require-numbers').checked = settings.security?.passwordRequireNumbers || false;
                document.getElementById('password-require-symbols').checked = settings.security?.passwordRequireSymbols || false;
                document.getElementById('login-attempt-limit').checked = settings.security?.loginAttemptLimit || false;
                document.getElementById('max-login-attempts').value = settings.security?.maxLoginAttempts || 5;
                document.getElementById('lockout-duration').value = settings.security?.lockoutDuration || 15;

                // 启用/禁用相关字段
                this.toggleLoginAttemptFields();

                // 邮件配置
                document.getElementById('mailer-type').value = settings.email?.mailerType || 'smtp';
                document.getElementById('smtp-host').value = settings.email?.smtpHost || '';
                document.getElementById('smtp-port').value = settings.email?.smtpPort || 587;
                document.getElementById('smtp-username').value = settings.email?.smtpUsername || '';
                document.getElementById('from-email').value = settings.email?.fromEmail || '';
                document.getElementById('from-name').value = settings.email?.fromName || '';
                document.getElementById('smtp-auth').checked = settings.email?.smtpAuth || false;
                document.getElementById('smtp-secure').checked = settings.email?.smtpSecure || false;

                // 备份与恢复
                document.getElementById('backup-frequency').value = settings.backup?.backupFrequency || 'weekly';
                document.getElementById('backup-retention').value = settings.backup?.backupRetention || 30;
                document.getElementById('backup-database').checked = settings.backup?.backupDatabase || false;
                document.getElementById('backup-files').checked = settings.backup?.backupFiles || false;
            }

            // 保存设置
            saveSettings() {
                // 从表单收集设置
                this.collectFormData();
                
                // 保存到localStorage
                localStorage.setItem('luyao_settings', JSON.stringify(this.currentSettings));
                
                this.showNotification('设置保存成功', 'success');
            }

            // 从表单收集数据
            collectFormData() {
                this.currentSettings = {
                    general: {
                        siteName: document.getElementById('site-name').value,
                        siteUrl: document.getElementById('site-url').value,
                        siteDescription: document.getElementById('site-description').value,
                        contactEmail: document.getElementById('contact-email').value,
                        contactPhone: document.getElementById('contact-phone').value,
                        siteKeywords: document.getElementById('site-keywords').value
                    },
                    system: {
                        timezone: document.getElementById('timezone').value,
                        language: document.getElementById('language').value,
                        currency: document.getElementById('currency').value,
                        dateFormat: document.getElementById('date-format').value,
                        itemsPerPage: document.getElementById('items-per-page').value,
                        maintenanceMode: document.getElementById('maintenance-mode').checked
                    },
                    security: {
                        sessionTimeout: parseInt(document.getElementById('session-timeout').value) || 30,
                        passwordMinLength: parseInt(document.getElementById('password-min-length').value) || 8,
                        passwordRequireUppercase: document.getElementById('password-require-uppercase').checked,
                        passwordRequireLowercase: document.getElementById('password-require-lowercase').checked,
                        passwordRequireNumbers: document.getElementById('password-require-numbers').checked,
                        passwordRequireSymbols: document.getElementById('password-require-symbols').checked,
                        loginAttemptLimit: document.getElementById('login-attempt-limit').checked,
                        maxLoginAttempts: parseInt(document.getElementById('max-login-attempts').value) || 5,
                        lockoutDuration: parseInt(document.getElementById('lockout-duration').value) || 15
                    },
                    email: {
                        mailerType: document.getElementById('mailer-type').value,
                        smtpHost: document.getElementById('smtp-host').value,
                        smtpPort: parseInt(document.getElementById('smtp-port').value) || 587,
                        smtpUsername: document.getElementById('smtp-username').value,
                        smtpPassword: document.getElementById('smtp-password').value,
                        fromEmail: document.getElementById('from-email').value,
                        fromName: document.getElementById('from-name').value,
                        smtpAuth: document.getElementById('smtp-auth').checked,
                        smtpSecure: document.getElementById('smtp-secure').checked
                    },
                    backup: {
                        backupFrequency: document.getElementById('backup-frequency').value,
                        backupRetention: parseInt(document.getElementById('backup-retention').value) || 30,
                        backupDatabase: document.getElementById('backup-database').checked,
                        backupFiles: document.getElementById('backup-files').checked
                    }
                };
            }

            // 设置选项卡导航
            setupTabNavigation() {
                const tabs = document.querySelectorAll('.settings-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // 移除所有活动状态
                        tabs.forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        // 添加当前活动状态
                        tab.classList.add('active');
                        const tabId = tab.getAttribute('data-tab');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                    });
                });
            }

            // 设置事件监听器
            setupEventListeners() {
                // 保存设置按钮
                document.getElementById('save-settings-btn').addEventListener('click', () => {
                    this.saveSettings();
                });

                // 刷新按钮
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    this.loadSettings();
                    this.showNotification('设置已刷新', 'success');
                });

                // 登录尝试限制切换
                document.getElementById('login-attempt-limit').addEventListener('change', () => {
                    this.toggleLoginAttemptFields();
                });

                // 测试邮件按钮
                document.getElementById('test-email-btn').addEventListener('click', () => {
                    this.showTestEmailModal();
                });

                // 发送测试邮件
                document.getElementById('send-test-email').addEventListener('click', () => {
                    this.sendTestEmail();
                });

                // 立即备份按钮
                document.getElementById('backup-now-btn').addEventListener('click', () => {
                    this.createBackup();
                });

                // 恢复备份按钮
                document.getElementById('restore-backup-btn').addEventListener('click', () => {
                    this.restoreBackup();
                });

                // 重置设置按钮
                document.getElementById('reset-settings-btn').addEventListener('click', () => {
                    this.showResetConfirmation();
                });

                // 确认重置
                document.getElementById('confirm-reset').addEventListener('click', () => {
                    this.resetSettings();
                });

                // 清除缓存按钮
                document.getElementById('clear-cache-btn').addEventListener('click', () => {
                    this.clearCache();
                });

                // 关闭模态框
                document.querySelectorAll('.close-modal').forEach(button => {
                    button.addEventListener('click', function() {
                        const modal = this.closest('.modal');
                        if (modal) {
                            modal.classList.remove('active');
                        }
                    });
                });

                // 取消按钮
                document.getElementById('cancel-test-email').addEventListener('click', () => {
                    this.closeModal('test-email-modal');
                });

                document.getElementById('cancel-reset').addEventListener('click', () => {
                    this.closeModal('reset-settings-modal');
                });

                // 点击模态框外部关闭
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === this) {
                            this.classList.remove('active');
                        }
                    });
                });

                // Logo上传
                this.setupLogoUpload();
            }

            // 切换登录尝试相关字段
            toggleLoginAttemptFields() {
                const isEnabled = document.getElementById('login-attempt-limit').checked;
                document.getElementById('max-login-attempts').disabled = !isEnabled;
                document.getElementById('lockout-duration').disabled = !isEnabled;
            }

            // 显示测试邮件模态框
            showTestEmailModal() {
                document.getElementById('test-email-modal').classList.add('active');
                document.getElementById('test-email-result').style.display = 'none';
            }

            // 发送测试邮件
            sendTestEmail() {
                const email = document.getElementById('test-email-address').value;
                const resultDiv = document.getElementById('test-email-result');
                
                if (!email) {
                    resultDiv.innerHTML = '<p class="text-danger">请输入有效的邮箱地址</p>';
                    resultDiv.style.display = 'block';
                    return;
                }

                // 模拟发送测试邮件
                resultDiv.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> 正在发送测试邮件...</p>';
                resultDiv.style.display = 'block';

                setTimeout(() => {
                    // 模拟成功发送
                    resultDiv.innerHTML = `
                        <p class="text-success">
                            <i class="fas fa-check-circle"></i> 测试邮件已发送到 ${email}
                        </p>
                        <p class="text-muted">请检查您的收件箱，如果未收到请检查垃圾邮件文件夹</p>
                    `;
                }, 2000);
            }

            // 创建备份
            createBackup() {
                this.showNotification('正在创建系统备份...', 'info');
                
                // 模拟备份过程
                setTimeout(() => {
                    this.showNotification('系统备份创建成功', 'success');
                }, 3000);
            }

            // 恢复备份
            restoreBackup() {
                // 在实际应用中，这里应该有一个文件选择器
                this.showNotification('请选择要恢复的备份文件', 'info');
            }

            // 显示重置确认
            showResetConfirmation() {
                document.getElementById('reset-settings-modal').classList.add('active');
            }

            // 重置设置
            resetSettings() {
                // 清除设置
                localStorage.removeItem('luyao_settings');
                
                // 重新加载默认设置
                this.loadDefaultSettings();
                
                this.closeModal('reset-settings-modal');
                this.showNotification('设置已恢复为默认值', 'success');
            }

            // 清除缓存
            clearCache() {
                // 在实际应用中，这里应该清除各种缓存
                this.showNotification('系统缓存已清除', 'success');
            }

            // 设置Logo上传
            setupLogoUpload() {
                const uploadArea = document.getElementById('logo-upload-area');
                const fileInput = document.getElementById('site-logo');
                const preview = document.getElementById('logo-preview');

                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });

                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        if (file.size > 2 * 1024 * 1024) {
                            this.showNotification('图片大小不能超过 2MB', 'error');
                            return;
                        }
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            preview.innerHTML = `<img src="${e.target.result}" alt="站点Logo">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // 拖拽上传
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        fileInput.files = e.dataTransfer.files;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
            }

            // 关闭模态框
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            // 显示通知
            showNotification(message, type = 'info') {
                // 在实际应用中，可以使用更美观的通知组件
                alert(`${type.toUpperCase()}: ${message}`);
            }
        }

        // 初始化系统设置
        let settingsManagement;

        document.addEventListener('DOMContentLoaded', function() {
            settingsManagement = new SettingsManagement();
        });
    </script>
</body>
</html>
