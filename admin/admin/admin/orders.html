<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>订单管理 - Luyao Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .toolbar input,
    .toolbar select,
    .toolbar button {
      padding: 6px 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #fff;
    }
    .toolbar button {
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .toolbar button:hover { background: #0056b3; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    th, td {
      padding: 10px;
      border: 1px solid #e1e1e1;
      text-align: center;
    }
    th {
      background: #f0f0f0;
      font-weight: 600;
    }

    .status-tag {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      color: #fff;
    }
    .paid { background: #28a745; }
    .pending { background: #ffc107; color: #000; }
    .canceled { background: #dc3545; }
    .completed { background: #17a2b8; }
    .shipped { background: #6f42c1; }

    .pay-alipay { color: #1677ff; }
    .pay-wechat { color: #07c160; }
    .pay-kbz { color: #0095ff; }

    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 15px;
      gap: 5px;
    }
    .pagination button {
      padding: 6px 12px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
    .pagination button.active {
      background: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      max-width: 480px;
      width: 90%;
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 10px; right: 10px;
      background: transparent;
      border: none;
      font-size: 20px;
      color: #666;
      cursor: pointer;
    }
    .btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>订单管理</h1>

  <div class="toolbar">
    <input type="text" id="searchInput" placeholder="搜索订单号 / 用户名...">
    <select id="filterStatus">
      <option value="">全部状态</option>
      <option value="pending">待支付</option>
      <option value="paid">已支付</option>
      <option value="shipped">已发货</option>
      <option value="completed">已完成</option>
      <option value="canceled">已取消</option>
    </select>
    <select id="filterPay">
      <option value="">全部支付方式</option>
      <option value="alipay">支付宝</option>
      <option value="wechat">微信支付</option>
      <option value="kbz">KBZ Pay</option>
    </select>
    <button onclick="exportCSV()">导出 CSV</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>订单号</th>
        <th>用户</th>
        <th>金额</th>
        <th>支付方式</th>
        <th>状态</th>
        <th>时间</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="orderTableBody"></tbody>
  </table>

  <div class="pagination" id="pagination"></div>

  <div class="modal" id="orderModal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">&times;</button>
      <h3>订单详情</h3>
      <div id="orderDetails"></div>
    </div>
  </div>

  <script>
    const orders = [];
    const payNames = { alipay: '支付宝', wechat: '微信支付', kbz: 'KBZ Pay' };
    const statusNames = {
      pending: '待支付',
      paid: '已支付',
      shipped: '已发货',
      completed: '已完成',
      canceled: '已取消'
    };

    for (let i = 1; i <= 50; i++) {
      const pays = ['alipay', 'wechat', 'kbz'];
      const statuses = ['pending', 'paid', 'shipped', 'completed', 'canceled'];
      orders.push({
        id: `20251019${String(i).padStart(4, '0')}`,
        user: `用户${i}`,
        amount: Math.floor(Math.random() * 500) + 50,
        pay: pays[Math.floor(Math.random() * pays.length)],
        status: statuses[Math.floor(Math.random() * statuses.length)],
        date: `2025-10-19 ${String(Math.floor(Math.random() * 24)).padStart(2,'0')}:${String(Math.floor(Math.random() * 60)).padStart(2,'0')}`
      });
    }

    const pageSize = 10;
    let currentPage = 1;

    function renderOrders() {
      const searchText = document.getElementById('searchInput').value.toLowerCase();
      const statusFilter = document.getElementById('filterStatus').value;
      const payFilter = document.getElementById('filterPay').value;

      let filtered = orders.filter(o =>
        (o.id.toLowerCase().includes(searchText) || o.user.toLowerCase().includes(searchText)) &&
        (statusFilter === '' || o.status === statusFilter) &&
        (payFilter === '' || o.pay === payFilter)
      );

      const totalPages = Math.ceil(filtered.length / pageSize);
      currentPage = Math.min(currentPage, totalPages || 1);
      const start = (currentPage - 1) * pageSize;
      const pageData = filtered.slice(start, start + pageSize);

      const tbody = document.getElementById('orderTableBody');
      tbody.innerHTML = '';

      pageData.forEach(order => {
        const payIcon = order.pay === 'alipay' ? '<i class="fab fa-alipay pay-alipay"></i>' :
                        order.pay === 'wechat' ? '<i class="fab fa-weixin pay-wechat"></i>' :
                        '<i class="fa-solid fa-wallet pay-kbz"></i>';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${order.id}</td>
          <td>${order.user}</td>
          <td>￥${order.amount}</td>
          <td>${payIcon} ${payNames[order.pay]}</td>
          <td><span class="status-tag ${order.status}">${statusNames[order.status]}</span></td>
          <td>${order.date}</td>
          <td>
            <button class="btn" onclick="viewOrder('${order.id}')">查看</button>
            <button class="btn" onclick="markStatus('${order.id}','completed')">完成</button>
            <button class="btn" onclick="markStatus('${order.id}','shipped')">发货</button>
            <button class="btn" onclick="markStatus('${order.id}','canceled')">取消</button>
          </td>`;
        tbody.appendChild(tr);
      });
      renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        if (i === currentPage) btn.classList.add('active');
        btn.addEventListener('click', () => { currentPage = i; renderOrders(); });
        pagination.appendChild(btn);
      }
    }

    function viewOrder(id) {
      const order = orders.find(o => o.id === id);
      const details = document.getElementById('orderDetails');
      details.innerHTML = `
        <p><b>订单号：</b>${order.id}</p>
        <p><b>用户：</b>${order.user}</p>
        <p><b>金额：</b>￥${order.amount}</p>
        <p><b>支付方式：</b>${payNames[order.pay]}</p>
        <p><b>状态：</b>${statusNames[order.status]}</p>
        <p><b>下单时间：</b>${order.date}</p>`;
      document.getElementById('orderModal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('orderModal').style.display = 'none'; }
    function markStatus(id, status) {
      const order = orders.find(o => o.id === id);
      if (order) { order.status = status; renderOrders(); }
    }
    function exportCSV() {
      let csv = '订单号,用户,金额,支付方式,状态,时间\n';
      orders.forEach(o => {
        csv += `${o.id},${o.user},${o.amount},${payNames[o.pay]},${statusNames[o.status]},${o.date}\n`;
      });
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = '订单列表.csv';
      link.click();
    }
    document.getElementById('searchInput').addEventListener('input', () => {currentPage=1;renderOrders();});
    document.getElementById('filterStatus').addEventListener('change', () => {currentPage=1;renderOrders();});
    document.getElementById('filterPay').addEventListener('change', () => {currentPage=1;renderOrders();});
    renderOrders();
  </script>
</body>
</html>
