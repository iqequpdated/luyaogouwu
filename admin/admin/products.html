<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品管理 - 璐瑶购物后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .admin-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 页面头部 */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* 按钮样式 */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #bdc3c7;
            color: #7f8c8d;
        }

        .btn-outline:hover {
            background-color: #ecf0f1;
        }

        .btn-outline-danger {
            background-color: transparent;
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }

        .btn-outline-danger:hover {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        /* 工具栏 */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }

        .search-box input {
            width: 100%;
            padding: 10px 10px 10px 35px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-icon.primary { background: rgba(52, 152, 219, 0.1); color: #3498db; }
        .stat-icon.success { background: rgba(46, 204, 113, 0.1); color: #27ae60; }
        .stat-icon.warning { background: rgba(243, 156, 18, 0.1); color: #f39c12; }
        .stat-icon.danger { background: rgba(231, 76, 60, 0.1); color: #e74c3c; }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* 卡片和表格 */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* 产品管理特定样式 */
        .product-image-preview {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid #e9ecef;
        }
        
        .stock-low {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .stock-normal {
            color: #27ae60;
        }
        
        .product-actions {
            display: flex;
            gap: 5px;
        }
        
        .image-upload-container {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .image-upload-container:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }
        
        .image-upload-container.dragover {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .category-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .category-digital {
            background-color: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }
        
        .category-clothing {
            background-color: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }
        
        .category-sports {
            background-color: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }
        
        .category-home {
            background-color: rgba(155, 89, 182, 0.1);
            color: #9b59b6;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-active {
            background-color: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }
        
        .status-inactive {
            background-color: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }
        
        .bulk-actions {
            display: none;
            align-items: center;
            gap: 15px;
            padding: 10px 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .bulk-actions.show {
            display: flex;
        }
        
        .price-input {
            position: relative;
        }
        
        .price-input::before {
            content: '¥';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        
        .price-input input {
            padding-left: 30px;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* 分页 */
        .pagination {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #ecf0f1;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination-btn:hover {
            background: #ecf0f1;
        }

        .pagination-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .pagination-info {
            color: #7f8c8d;
            font-size: 14px;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #bdc3c7;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #7f8c8d;
        }

        .text-center {
            text-align: center;
        }

        .text-danger {
            color: #e74c3c;
        }

        .text-muted {
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div>
                <div class="page-title">产品管理</div>
                <div class="breadcrumb">
                    <a href="../dashboard.html">首页</a>
                    <i class="fas fa-chevron-right"></i>
                    <a href="products.html">产品管理</a>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn btn-outline" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                    刷新
                </button>
                <button class="btn btn-primary" id="add-product-btn">
                    <i class="fas fa-plus"></i>
                    添加产品
                </button>
            </div>
        </div>

        <!-- 批量操作栏 -->
        <div class="bulk-actions" id="bulk-actions">
            <div>
                <strong>已选择 <span id="selected-count">0</span> 个产品</strong>
            </div>
            <div class="card-actions">
                <button class="btn btn-outline btn-sm" id="bulk-activate">
                    <i class="fas fa-check"></i>
                    批量上架
                </button>
                <button class="btn btn-outline btn-sm" id="bulk-deactivate">
                    <i class="fas fa-times"></i>
                    批量下架
                </button>
                <button class="btn btn-outline-danger btn-sm" id="bulk-delete">
                    <i class="fas fa-trash"></i>
                    批量删除
                </button>
                <button class="btn btn-outline btn-sm" id="clear-selection">
                    <i class="fas fa-times"></i>
                    取消选择
                </button>
            </div>
        </div>

        <!-- 搜索和筛选工具栏 -->
        <div class="toolbar">
            <div class="toolbar-left">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="搜索产品名称、描述...">
                </div>
            </div>
            <div class="toolbar-right">
                <div class="filter-group">
                    <select class="filter-select" id="category-filter">
                        <option value="">所有分类</option>
                        <option value="digital">数码产品</option>
                        <option value="clothing">服装</option>
                        <option value="sports">运动户外</option>
                        <option value="home">家居用品</option>
                        <option value="beauty">美妆护肤</option>
                    </select>
                    <select class="filter-select" id="status-filter">
                        <option value="">所有状态</option>
                        <option value="active">上架</option>
                        <option value="inactive">下架</option>
                    </select>
                    <select class="filter-select" id="stock-filter">
                        <option value="">库存状态</option>
                        <option value="low">库存紧张</option>
                        <option value="normal">库存充足</option>
                        <option value="out">缺货</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 产品统计卡片 -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-icon primary">
                    <i class="fas fa-box"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="total-products">0</div>
                    <div class="stat-label">总产品数</div>
                </div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon success">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="active-products">0</div>
                    <div class="stat-label">上架产品</div>
                </div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon warning">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="low-stock-products">0</div>
                    <div class="stat-label">低库存产品</div>
                </div>
            </div>
            <div class="stat-card danger">
                <div class="stat-icon danger">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="out-of-stock-products">0</div>
                    <div class="stat-label">缺货产品</div>
                </div>
            </div>
        </div>

        <!-- 产品列表 -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">产品列表</div>
                <div class="card-actions">
                    <button class="btn btn-outline" id="export-btn">
                        <i class="fas fa-download"></i>
                        导出数据
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="50">
                                <input type="checkbox" id="select-all">
                            </th>
                            <th width="80">图片</th>
                            <th>产品信息</th>
                            <th width="120">分类</th>
                            <th width="120">价格</th>
                            <th width="100">库存</th>
                            <th width="100">销量</th>
                            <th width="100">状态</th>
                            <th width="150">操作</th>
                        </tr>
                    </thead>
                    <tbody id="products-table-body">
                        <!-- 产品数据将通过JavaScript动态加载 -->
                    </tbody>
                </table>
            </div>

            <!-- 分页 -->
            <div class="pagination" id="pagination">
                <!-- 分页按钮将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 添加/编辑产品模态框 -->
    <div class="modal" id="product-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">添加产品</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-name">产品名称 *</label>
                            <input type="text" id="product-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="product-sku">SKU编码 *</label>
                            <input type="text" id="product-sku" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">产品分类 *</label>
                            <select id="product-category" class="form-control" required>
                                <option value="">选择分类</option>
                                <option value="digital">数码产品</option>
                                <option value="clothing">服装</option>
                                <option value="sports">运动户外</option>
                                <option value="home">家居用品</option>
                                <option value="beauty">美妆护肤</option>
                                <option value="food">食品饮料</option>
                                <option value="books">图书文具</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="product-brand">品牌</label>
                            <input type="text" id="product-brand" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group price-input">
                            <label for="product-price">销售价格 *</label>
                            <input type="number" id="product-price" class="form-control" step="0.01" min="0" required>
                        </div>
                        <div class="form-group price-input">
                            <label for="product-original-price">原价</label>
                            <input type="number" id="product-original-price" class="form-control" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-stock">库存数量 *</label>
                            <input type="number" id="product-stock" class="form-control" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="product-status">产品状态 *</label>
                            <select id="product-status" class="form-control" required>
                                <option value="active">上架</option>
                                <option value="inactive">下架</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="product-description">产品描述</label>
                        <textarea id="product-description" class="form-control" rows="4" placeholder="请输入产品详细描述..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>产品图片</label>
                        <div class="image-upload-container" id="image-upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div>
                                <div>点击上传图片或拖拽图片到这里</div>
                                <div class="text-muted" style="font-size: 12px; margin-top: 5px;">
                                    支持 JPG、PNG 格式，大小不超过 2MB
                                </div>
                            </div>
                            <input type="file" id="product-image" accept="image/*" style="display: none;">
                            <img id="image-preview" class="image-preview" alt="图片预览">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="product-features">产品特性</label>
                        <textarea id="product-features" class="form-control" rows="3" placeholder="每行输入一个产品特性..."></textarea>
                        <div class="form-text">每行输入一个特性，例如：防水设计、超长续航等</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-product">取消</button>
                <button class="btn btn-primary" id="save-product">保存产品</button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div class="modal" id="delete-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <div class="modal-title">确认删除</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>确定要删除这个产品吗？此操作不可恢复。</p>
                <p class="text-danger"><strong>注意：如果产品已有订单记录，删除可能会影响数据统计。</strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-delete">取消</button>
                <button class="btn btn-danger" id="confirm-delete">确认删除</button>
            </div>
        </div>
    </div>

    <script>
        // 产品数据管理类
        class ProductManager {
            static getAllProducts() {
                const storedProducts = localStorage.getItem('luyao_products');
                if (storedProducts) {
                    return JSON.parse(storedProducts);
                }
                
                // 默认示例数据
                const defaultProducts = [
                    {
                        id: '1',
                        name: 'iPhone 14 Pro',
                        sku: 'APPLE-IP14P-256',
                        category: 'digital',
                        brand: 'Apple',
                        price: 8999.00,
                        originalPrice: 9999.00,
                        stock: 25,
                        status: 'active',
                        salesCount: 156,
                        description: '最新款iPhone，搭载A16芯片，4800万像素主摄像头',
                        features: ['A16芯片', '4800万像素', '灵动岛设计', '全天候显示'],
                        images: ['https://via.placeholder.com/400x400?text=iPhone+14+Pro']
                    },
                    {
                        id: '2',
                        name: '运动跑步鞋',
                        sku: 'NIKE-AIRMAX-2024',
                        category: 'sports',
                        brand: 'Nike',
                        price: 699.00,
                        originalPrice: 899.00,
                        stock: 8,
                        status: 'active',
                        salesCount: 89,
                        description: '轻便舒适的运动跑步鞋，适合日常锻炼和跑步',
                        features: ['透气网面', '缓震技术', '防滑鞋底', '轻量化设计'],
                        images: ['https://via.placeholder.com/400x400?text=Running+Shoes']
                    },
                    {
                        id: '3',
                        name: '陶瓷保温杯',
                        sku: 'CUP-CERAMIC-350',
                        category: 'home',
                        brand: '膳魔师',
                        price: 199.00,
                        stock: 0,
                        status: 'inactive',
                        salesCount: 234,
                        description: '304不锈钢内胆，陶瓷涂层，保温保冷效果佳',
                        features: ['陶瓷涂层', '一键开盖', '防漏设计', '便携提绳'],
                        images: ['https://via.placeholder.com/400x400?text=Thermos+Cup']
                    }
                ];
                
                localStorage.setItem('luyao_products', JSON.stringify(defaultProducts));
                return defaultProducts;
            }

            static getProductById(id) {
                const products = this.getAllProducts();
                return products.find(product => product.id === id);
            }

            static addProduct(productData) {
                const products = this.getAllProducts();
                const newProduct = {
                    id: Date.now().toString(),
                    ...productData,
                    salesCount: 0,
                    createdAt: new Date().toISOString()
                };
                
                products.push(newProduct);
                this.saveProducts(products);
                return newProduct;
            }

            static updateProduct(id, updates) {
                const products = this.getAllProducts();
                const index = products.findIndex(product => product.id === id);
                
                if (index !== -1) {
                    products[index] = { ...products[index], ...updates, updatedAt: new Date().toISOString() };
                    this.saveProducts(products);
                    return products[index];
                }
                
                throw new Error('产品不存在');
            }

            static deleteProduct(id) {
                const products = this.getAllProducts();
                const filteredProducts = products.filter(product => product.id !== id);
                this.saveProducts(filteredProducts);
            }

            static saveProducts(products) {
                localStorage.setItem('luyao_products', JSON.stringify(products));
            }
        }

        // 产品管理逻辑
        class ProductManagement {
            constructor() {
                this.currentPage = 1;
                this.pageSize = 10;
                this.currentFilters = {};
                this.selectedProducts = new Set();
                this.editingProductId = null;
                this.productToDelete = null;
                
                this.init();
            }

            init() {
                this.loadProducts();
                this.setupEventListeners();
                this.updateStatistics();
            }

            loadProducts(page = 1, filters = {}) {
                this.currentPage = page;
                this.currentFilters = filters;

                let products = ProductManager.getAllProducts();

                // 应用筛选
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    products = products.filter(product => 
                        product.name.toLowerCase().includes(searchTerm) ||
                        (product.description && product.description.toLowerCase().includes(searchTerm)) ||
                        (product.sku && product.sku.toLowerCase().includes(searchTerm))
                    );
                }

                if (filters.category) {
                    products = products.filter(product => product.category === filters.category);
                }

                if (filters.status) {
                    products = products.filter(product => product.status === filters.status);
                }

                if (filters.stock) {
                    switch (filters.stock) {
                        case 'low':
                            products = products.filter(product => product.stock > 0 && product.stock <= 10);
                            break;
                        case 'normal':
                            products = products.filter(product => product.stock > 10);
                            break;
                        case 'out':
                            products = products.filter(product => product.stock === 0);
                            break;
                    }
                }

                // 分页
                const totalProducts = products.length;
                const totalPages = Math.ceil(totalProducts / this.pageSize);
                const startIndex = (page - 1) * this.pageSize;
                const paginatedProducts = products.slice(startIndex, startIndex + this.pageSize);

                this.renderProducts(paginatedProducts);
                this.renderPagination(totalPages, page, totalProducts);
                this.updateStatistics();
            }

            renderProducts(products) {
                const tbody = document.getElementById('products-table-body');
                
                if (products.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" class="text-center">
                                <div class="empty-state">
                                    <i class="fas fa-box-open"></i>
                                    <h3>暂无产品数据</h3>
                                    <p>点击"添加产品"按钮创建第一个产品</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = products.map(product => `
                    <tr>
                        <td>
                            <input type="checkbox" class="product-checkbox" value="${product.id}" 
                                   ${this.selectedProducts.has(product.id) ? 'checked' : ''}>
                        </td>
                        <td>
                            <img src="${product.images && product.images[0] ? product.images[0] : 'https://via.placeholder.com/60x60?text=No+Image'}" 
                                 alt="${product.name}" class="product-image-preview">
                        </td>
                        <td>
                            <div class="product-info">
                                <div class="product-name" style="font-weight: 500; margin-bottom: 3px;">${product.name}</div>
                                <div class="product-sku" style="font-size: 12px; color: #6c757d;">SKU: ${product.sku || 'N/A'}</div>
                                <div class="product-description" style="font-size: 12px; color: #6c757d; margin-top: 3px;">
                                    ${product.description ? product.description.substring(0, 50) + '...' : '暂无描述'}
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="category-badge category-${product.category}">
                                ${this.getCategoryText(product.category)}
                            </span>
                        </td>
                        <td>
                            <div style="font-weight: 500;">¥${product.price.toFixed(2)}</div>
                            ${product.originalPrice ? `<div style="font-size: 12px; color: #6c757d; text-decoration: line-through;">¥${product.originalPrice.toFixed(2)}</div>` : ''}
                        </td>
                        <td>
                            <span class="${product.stock <= 10 ? 'stock-low' : 'stock-normal'}">
                                ${product.stock}
                            </span>
                        </td>
                        <td>${product.salesCount || 0}</td>
                        <td>
                            <span class="status-badge status-${product.status}">
                                ${product.status === 'active' ? '上架' : '下架'}
                            </span>
                        </td>
                        <td>
                            <div class="product-actions">
                                <button class="btn btn-outline btn-sm" onclick="productManagement.editProduct('${product.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="productManagement.toggleStatus('${product.id}')">
                                    <i class="fas ${product.status === 'active' ? 'fa-eye-slash' : 'fa-eye'}"></i>
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="productManagement.confirmDelete('${product.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderPagination(totalPages, currentPage, totalProducts) {
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = `<span class="pagination-info">共 ${totalProducts} 条记录</span>`;
                    return;
                }

                let paginationHTML = '';
                
                // 上一页
                if (currentPage > 1) {
                    paginationHTML += `
                        <button class="pagination-btn" onclick="productManagement.loadProducts(${currentPage - 1})">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    `;
                }

                // 页码
                const showPages = 5;
                let startPage = Math.max(1, currentPage - Math.floor(showPages / 2));
                let endPage = Math.min(totalPages, startPage + showPages - 1);
                
                if (endPage - startPage + 1 < showPages) {
                    startPage = Math.max(1, endPage - showPages + 1);
                }

                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `
                        <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="productManagement.loadProducts(${i})">
                            ${i}
                        </button>
                    `;
                }

                // 下一页
                if (currentPage < totalPages) {
                    paginationHTML += `
                        <button class="pagination-btn" onclick="productManagement.loadProducts(${currentPage + 1})">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    `;
                }

                paginationHTML += `<span class="pagination-info">共 ${totalProducts} 条记录</span>`;
                pagination.innerHTML = paginationHTML;
            }

            updateStatistics() {
                const products = ProductManager.getAllProducts();
                const activeProducts = products.filter(p => p.status === 'active').length;
                const lowStockProducts = products.filter(p => p.stock > 0 && p.stock <= 10).length;
                const outOfStockProducts = products.filter(p => p.stock === 0).length;

                document.getElementById('total-products').textContent = products.length;
                document.getElementById('active-products').textContent = activeProducts;
                document.getElementById('low-stock-products').textContent = lowStockProducts;
                document.getElementById('out-of-stock-products').textContent = outOfStockProducts;
            }

            getCategoryText(category) {
                const categoryMap = {
                    'digital': '数码产品',
                    'clothing': '服装',
                    'sports': '运动户外',
                    'home': '家居用品',
                    'beauty': '美妆护肤',
                    'food': '食品饮料',
                    'books': '图书文具'
                };
                return categoryMap[category] || category;
            }

            setupEventListeners() {
                // 搜索
                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', this.debounce((e) => {
                    this.loadProducts(1, { ...this.currentFilters, search: e.target.value });
                }, 500));

                // 筛选器
                document.getElementById('category-filter').addEventListener('change', (e) => {
                    this.loadProducts(1, { ...this.currentFilters, category: e.target.value });
                });

                document.getElementById('status-filter').addEventListener('change', (e) => {
                    this.loadProducts(1, { ...this.currentFilters, status: e.target.value });
                });

                document.getElementById('stock-filter').addEventListener('change', (e) => {
                    this.loadProducts(1, { ...this.currentFilters, stock: e.target.value });
                });

                // 刷新按钮
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    this.loadProducts(this.currentPage, this.currentFilters);
                    this.showNotification('数据已刷新', 'success');
                });

                // 添加产品按钮
                document.getElementById('add-product-btn').addEventListener('click', () => {
                    this.showProductModal();
                });

                // 保存产品
                document.getElementById('save-product').addEventListener('click', () => {
                    this.saveProduct();
                });

                // 取消操作
                document.getElementById('cancel-product').addEventListener('click', () => {
                    this.closeModal('product-modal');
                });

                document.getElementById('cancel-delete').addEventListener('click', () => {
                    this.closeModal('delete-modal');
                });

                // 全选/取消全选
                document.getElementById('select-all').addEventListener('change', (e) => {
                    const checkboxes = document.querySelectorAll('.product-checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = e.target.checked;
                        if (e.target.checked) {
                            this.selectedProducts.add(checkbox.value);
                        } else {
                            this.selectedProducts.delete(checkbox.value);
                        }
                    });
                    this.updateBulkActions();
                });

                // 单个选择框
                document.addEventListener('change', (e) => {
                    if (e.target.classList.contains('product-checkbox')) {
                        if (e.target.checked) {
                            this.selectedProducts.add(e.target.value);
                        } else {
                            this.selectedProducts.delete(e.target.value);
                        }
                        this.updateBulkActions();
                    }
                });

                // 批量操作
                document.getElementById('bulk-activate').addEventListener('click', () => {
                    this.bulkUpdateStatus('active');
                });

                document.getElementById('bulk-deactivate').addEventListener('click', () => {
                    this.bulkUpdateStatus('inactive');
                });

                document.getElementById('bulk-delete').addEventListener('click', () => {
                    this.bulkDelete();
                });

                document.getElementById('clear-selection').addEventListener('click', () => {
                    this.clearSelection();
                });

                // 导出按钮
                document.getElementById('export-btn').addEventListener('click', () => {
                    this.exportProducts();
                });

                // 确认删除
                document.getElementById('confirm-delete').addEventListener('click', () => {
                    this.deleteProduct();
                });

                // 关闭模态框
                document.querySelectorAll('.close-modal').forEach(button => {
                    button.addEventListener('click', function() {
                        const modal = this.closest('.modal');
                        if (modal) {
                            modal.classList.remove('active');
                        }
                    });
                });

                // 点击模态框外部关闭
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === this) {
                            this.classList.remove('active');
                        }
                    });
                });

                // 图片上传
                this.setupImageUpload();
            }

            showProductModal(product = null) {
                this.editingProductId = product ? product.id : null;
                const modal = document.getElementById('product-modal');
                const title = document.getElementById('modal-title');
                const form = document.getElementById('product-form');

                title.textContent = product ? '编辑产品' : '添加产品';
                
                if (product) {
                    // 编辑模式 - 填充数据
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-sku').value = product.sku || '';
                    document.getElementById('product-category').value = product.category;
                    document.getElementById('product-brand').value = product.brand || '';
                    document.getElementById('product-price').value = product.price;
                    document.getElementById('product-original-price').value = product.originalPrice || '';
                    document.getElementById('product-stock').value = product.stock;
                    document.getElementById('product-status').value = product.status;
                    document.getElementById('product-description').value = product.description || '';
                    document.getElementById('product-features').value = product.features ? product.features.join('\n') : '';

                    // 显示图片预览
                    if (product.images && product.images[0]) {
                        const preview = document.getElementById('image-preview');
                        preview.src = product.images[0];
                        preview.style.display = 'block';
                    }
                } else {
                    // 添加模式 - 清空表单
                    form.reset();
                    document.getElementById('image-preview').style.display = 'none';
                    document.getElementById('product-sku').value = 'SKU' + Date.now();
                }

                modal.classList.add('active');
            }

            saveProduct() {
                const form = document.getElementById('product-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const productData = {
                    name: document.getElementById('product-name').value,
                    sku: document.getElementById('product-sku').value,
                    category: document.getElementById('product-category').value,
                    brand: document.getElementById('product-brand').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    originalPrice: document.getElementById('product-original-price').value ? 
                        parseFloat(document.getElementById('product-original-price').value) : undefined,
                    stock: parseInt(document.getElementById('product-stock').value),
                    status: document.getElementById('product-status').value,
                    description: document.getElementById('product-description').value,
                    features: document.getElementById('product-features').value ? 
                        document.getElementById('product-features').value.split('\n').filter(f => f.trim()) : []
                };

                // 处理图片
                const imageInput = document.getElementById('product-image');
                if (imageInput.files.length > 0) {
                    const file = imageInput.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        productData.images = [e.target.result];
                        this.finalizeSave(productData);
                    };
                    reader.readAsDataURL(file);
                } else {
                    this.finalizeSave(productData);
                }
            }

            finalizeSave(productData) {
                try {
                    if (this.editingProductId) {
                        ProductManager.updateProduct(this.editingProductId, productData);
                        this.showNotification('产品更新成功', 'success');
                    } else {
                        ProductManager.addProduct(productData);
                        this.showNotification('产品添加成功', 'success');
                    }

                    this.closeModal('product-modal');
                    this.loadProducts(this.currentPage, this.currentFilters);
                } catch (error) {
                    this.showNotification('操作失败: ' + error.message, 'error');
                }
            }

            editProduct(productId) {
                const product = ProductManager.getProductById(productId);
                if (product) {
                    this.showProductModal(product);
                }
            }

            toggleStatus(productId) {
                const product = ProductManager.getProductById(productId);
                if (product) {
                    const newStatus = product.status === 'active' ? 'inactive' : 'active';
                    ProductManager.updateProduct(productId, { status: newStatus });
                    this.showNotification(`产品已${newStatus === 'active' ? '上架' : '下架'}`, 'success');
                    this.loadProducts(this.currentPage, this.currentFilters);
                }
            }

            confirmDelete(productId) {
                this.productToDelete = productId;
                document.getElementById('delete-modal').classList.add('active');
            }

            deleteProduct() {
                if (this.productToDelete) {
                    ProductManager.deleteProduct(this.productToDelete);
                    this.showNotification('产品删除成功', 'success');
                    this.closeModal('delete-modal');
                    this.loadProducts(this.currentPage, this.currentFilters);
                    this.productToDelete = null;
                }
            }

            bulkUpdateStatus(status) {
                if (this.selectedProducts.size === 0) return;

                const confirmMessage = `确定要将选中的 ${this.selectedProducts.size} 个产品${status === 'active' ? '上架' : '下架'}吗？`;
                if (!confirm(confirmMessage)) return;

                this.selectedProducts.forEach(productId => {
                    ProductManager.updateProduct(productId, { status });
                });

                this.showNotification(`已${status === 'active' ? '上架' : '下架'} ${this.selectedProducts.size} 个产品`, 'success');
                this.clearSelection();
                this.loadProducts(this.currentPage, this.currentFilters);
            }

            bulkDelete() {
                if (this.selectedProducts.size === 0) return;

                const confirmMessage = `确定要删除选中的 ${this.selectedProducts.size} 个产品吗？此操作不可恢复！`;
                if (!confirm(confirmMessage)) return;

                this.selectedProducts.forEach(productId => {
                    ProductManager.deleteProduct(productId);
                });

                this.showNotification(`已删除 ${this.selectedProducts.size} 个产品`, 'success');
                this.clearSelection();
                this.loadProducts(this.currentPage, this.currentFilters);
            }

            updateBulkActions() {
                const bulkActions = document.getElementById('bulk-actions');
                const selectedCount = document.getElementById('selected-count');

                selectedCount.textContent = this.selectedProducts.size;

                if (this.selectedProducts.size > 0) {
                    bulkActions.classList.add('show');
                } else {
                    bulkActions.classList.remove('show');
                }

                const totalCheckboxes = document.querySelectorAll('.product-checkbox').length;
                const checkedCheckboxes = document.querySelectorAll('.product-checkbox:checked').length;
                document.getElementById('select-all').checked = totalCheckboxes > 0 && checkedCheckboxes === totalCheckboxes;
            }

            clearSelection() {
                this.selectedProducts.clear();
                document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                this.updateBulkActions();
            }

            setupImageUpload() {
                const uploadArea = document.getElementById('image-upload-area');
                const fileInput = document.getElementById('product-image');
                const preview = document.getElementById('image-preview');

                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });

                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        if (file.size > 2 * 1024 * 1024) {
                            this.showNotification('图片大小不能超过 2MB', 'error');
                            return;
                        }
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            preview.src = e.target.result;
                            preview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // 拖拽上传
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        fileInput.files = e.dataTransfer.files;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
            }

            exportProducts() {
                const products = ProductManager.getAllProducts();
                const csvContent = this.convertToCSV(products);
                this.downloadCSV(csvContent, `products_${new Date().toISOString().split('T')[0]}.csv`);
                this.showNotification('产品数据导出成功', 'success');
            }

            convertToCSV(products) {
                const headers = ['名称', 'SKU', '分类', '品牌', '价格', '原价', '库存', '状态', '销量', '描述'];
                const rows = products.map(product => [
                    `"${product.name}"`,
                    `"${product.sku || ''}"`,
                    `"${this.getCategoryText(product.category)}"`,
                    `"${product.brand || ''}"`,
                    product.price,
                    product.originalPrice || '',
                    product.stock,
                    product.status === 'active' ? '上架' : '下架',
                    product.salesCount || 0,
                    `"${(product.description || '').replace(/"/g, '""')}"`
                ]);

                return [headers, ...rows].map(row => row.join(',')).join('\n');
            }

            downloadCSV(csvContent, filename) {
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            showNotification(message, type = 'info') {
                alert(message);
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        }

        // 初始化产品管理
        let productManagement;

        document.addEventListener('DOMContentLoaded', function() {
            productManagement = new ProductManagement();
        });
    </script>
</body>
</html>